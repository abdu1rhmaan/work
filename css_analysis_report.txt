# CSS SYSTEM ANALYSIS REPORT

## 1. Duplicate Selectors
The following selectors are defined multiple times, which causes cascading overrides and specificity confusion:

### Selector: `#main-buttons`
  - Line 25: `layout: grid; grid-size: 2; grid-gutter: 1 2; height: auto; margin-bottom: 2; padding: 0 1;`
  - Line 96: `layout: grid; grid-size: 2; grid-gutter: 1 2; height: auto; margin-bottom: 1;`
**Explanation**: The declaration at Line 96 overrides `margin-bottom` from 2 to 1. `padding: 0 1` from Line 25 remains active. Merging these is highly recommended.

### Selector: `CustomButton`
  - Line 104: `width: 100%; height: 1; min-height: 1; background: $boost; color: $text; border: none; padding: 0;`
  - Line 139: `background: $surface-lighten-1; color: $text;`
**Explanation**: Line 139 overrides the `background` property defined at line 104. This splits the component's core definition and makes theming difficult.

### Selector: `CustomButton:hover`
  - Line 134: `background: $accent; color: white;`
  - Line 1687: `background: #0056ff !important; color: white !important;`
**Explanation**: Line 1687 completely eradicates the hover state defined at Line 134, making it dead code. Furthermore, the use of `!important` makes contextual overrides (like the window-mode dimming) much harder.

### Selector: `CustomButton:focus`
  - Line 119: `outline: none; border: none; background: $boost; color: white; text-style: bold;`
  - Line 1692: `background: #1c2228; color: white;`
**Explanation**: Line 1692 overwrites the focused background color globally. Multiple focus definitions for the same generic component leads to inconsistent UI states if rules are moved.

### Selector: `#days-header`
  - Line 1175: `layout: grid; grid-size: 7; grid-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr; height: 3; padding: 0 1; background: $primary-darken-2; border-bottom: heavy $primary;`
  - Line 1728: `layout: grid; grid-size: 7; height: 3; background: $primary-darken-3; color: $accent; border-bottom: heavy $accent; margin-top: 1;`
**Explanation**: Massive overlap. Line 1728 overrides the background and border colors, adds a margin, but loses the explicit `grid-columns` definition and `padding` if they weren't cascaded properly. Both refer to identical layout requirements.

### Selector: `.day-cell`
  - Line 1210: `width: 100%; height: 3; background: $surface; color: $text; border: solid $primary 10%; margin: 0; padding: 0;`
  - Line 1739: `width: 100%; height: 3; content-align: center middle; border: solid $primary 10%;`
**Explanation**: Line 1739 adds `content-align` but re-declares `width`, `height`, and `border`. This is redundant and inflates the CSS parsing tree.

### Selector: `.has-shift`
  - Line 1235: Defined as `.day-cell.has-shift { border-bottom: heavy $success; background: $success 10%; }`
  - Line 1751: Defined generically as `.has-shift { color: $warning; text-style: bold; }`
**Explanation**: While not a strict duplicate selector, the split styling for the same logical component state creates confusion on which element governs the visual indicator.

### Selector: `.shifts-completed`
  - Line 1240: `.day-cell.shifts-completed { border-bottom: heavy cyan; background: cyan 8%; }`
  - Line 1756: `.shifts-completed { color: $success; text-style: dim; }`
**Explanation**: Split definition mimicking `.has-shift`.

### Selector: `.today`
  - Line 1225: `.day-cell.today { background: #0045e6 20% !important; border: tall #0045e6 !important; }`
  - Line 1746: `.today { background: $accent 20%; border: double $accent; }`
**Explanation**: Line 1746 will never apply to a `.day-cell.today` element because Line 1225 has higher specificity AND `!important` tags. Line 1746 is effectively dead code in the context of the calendar.

## 2. Conflicting Rules

### Extensive `!important` Usage Detected
The use of `!important` breaks the natural CSS cascade, making future theming and component nesting nearly impossible without relying on deeply nested specificity hacks. Conflicts arise when multiple overriding IDs fight for state.
- Line 161: `.window-mode #main-buttons CustomButton:hover` forces `background: $boost !important`.
- Line 168: `.window-mode #info-row *:hover` forces `background: $primary-darken-2 !important`.
- Line 1225: `.day-cell.today` forces `background: #0045e6 20% !important`.
- Line 1309: `.close-button:hover` forces `background: #d32f2f !important`.
- Line 1687: `CustomButton:hover` forces `background: #0056ff !important`.

**Detailed Conflict**: `CustomButton:hover` (Line 1687) vs `.window-mode #main-buttons CustomButton:hover` (Line 160).
Because Line 1687 has `!important` globally, it attempts to override ALL hovering. But Line 160 ALSO uses `!important` and has a higher specificity (`.window-mode #main-buttons CustomButton:hover`). Thus, Line 160 wins inside window mode. However, this is an arms race of `!important` declarations that makes the UI extremely fragile.

## 3. Layout Problems

Visual risks derived from conflicting or dangerous layout rules:

- **Container Overflows**: `BaseWindow` (Line 231) has `max-width: 90%` and `max-height: 90%`. However, internal components like `.modal-dialog` request `width: 85%; max-width: 120;`. If 120 columns exceeds 85% of 90% of the screen width, and the window restricts overflow, content might clip unexpectedly.
- **Percentages vs Fixed Constraints**: `#txn-details-dialog` requests `width: 90%; max-width: 60;`. On large 200+ column terminals, the width becomes clamped at 60. But internal elements might use `1fr`, which behaves well, modulo deeply nested items holding un-wrappable text.
- **Grid Mismatches**: `#main-buttons` specifies `grid-size: 2` but no explicit `grid-columns` (Line 25), falling back to implicit rules. By contrast, `#days-header` (Line 1175) safely specifies `grid-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr`.
- **Absolute Centering Collisions**: `ModalScreen` (Line 224) requests `align: center middle;` but `BaseWindow` (Line 231) forces `position: absolute;`. If elements inherit or mix these concepts, Textual may miscalculate offsets, resulting in windows shifting or jumping on focus.

## 4. Dead / Missing Styles

Rules targeting UI elements that no longer exist or are inactive:

- **Dead Styles**: `.window-mode #global-footer` (Line 154, 179). The file explicitly mentions `/* Global Footer removed as requested */` on Line 220, meaning these classes exist purely as bloat.
- **Orphaned Selectors**: `.break-row` (Line 1452) and `.expense-row` (Line 1438). Recent refactors moved logic to Windows and pure ListViews without these specific wrapper rows.
- **Unused MDI Selectors**: `#shifts-history-dialog`, `#analysis-view` min-height overwrites. Certain popups were refactored to generic `BaseWindow` classes. Checking ID targets reveals overlapping IDs like `#shifts-history-dialog #title` (Line 447) which is heavily tied to the old modal structure.

## 5. Specificity & Cascade Risks

Specificity traps make components un-themable and rigid:

- **Deep Nesting**: `#txn-details-dialog.txn-details-in #title` (Line 693) establishes an extremely high specificity (ID + Class + ID). Overriding this background from a theme file would be nearly impossible without matching or exceeding this exact DOM path.
- **Bottom-Heavy Redeclarations**: Redeclarations at the bottom of the file (e.g., `#days-header` at Line 1728) silently overwrite midway declarations (Line 1175). A developer changing colors at Line 1175 will see no effect in the app, creating debugging black holes.
- **Class Coupling**: Multiple `.has-shift` and `.today` variations force the logic layer (Python) to juggle exact class names rather than allowing Textual's CSS cascading to handle state cleanly.

## 6. Textual Compatibility Issues

Syntax or property conflicts specific to Textual's CSS engine:

- `scrollbar-size: 0 0;` (Line 938): Hiding scrollbars entirely might prevent mouse interaction in certain terminal emulators that rely on the scrollbar hit-box for dragging.
- `tint: #000000 20%` (Line 155): Used heavily for `.window-mode`. While supported, heavy tinting on low-color terminals (like 16-color) will wash out content severely or cause text to vanish.
- Explicit `display: block;` on `BaseWindow` (Line 240): Textual components usually default to `block`. Redundant definition.
- `box-sizing: border-box;` (Line 242): Necessary for `BaseWindow`, but lack of it on nested `#add-order-dialog` or `.modal-dialog` means their 85% width combined with padding (e.g., `padding: 1 2;`) will physically exceed the 85% container bounds, causing Textual to generate an internal horizontal scrollbar unexpectedly.

## 7. Performance Concerns

Observations regarding Textual rendering performance:

- **High-Cost Hover Re-evaluations**: Re-evaluating multiple hover states simultaneously (`.window-mode #info-row *:hover` Line 166) using generic `*` selectors combined with `!important` forces the engine to recalculate stylistic paths for every nested widget continuously on mouse movement.
- **Transparency Overhead**: Extensive use of `transparent` backgrounds and `tint:` layers forces multi-pass rendering. `BaseWindow` defines `layer: popup;` but also has `tint:` logic acting on its underlying dashboard peers. This forces full compositor updates on every frame if an animation or focus event fires.

## 8. Risk Severity Summary

- **Critical**: 
  - Overuse of `!important` on interactive states (Hover/Focus).
  - Duplicate component definitions (`CustomButton`) scattering theming authority.
- **High**: 
  - `box-sizing` collisions on percentage-based containers leading to accidental scrollbars.
  - Redeclared `#days-header` silently overriding styling.
- **Medium**: 
  - Dead code (`#global-footer`, `.expense-row`) bloating the parse tree.
  - Generic wildcard selectors (`*:hover`) degrading performance.
- **Low**: 
  - Redundant property declarations (`width: 100%` repeated in duplicate selectors).
